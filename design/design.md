# 2つのノードでのファイル共有アプリ(P2P)

# 機能
- 相手ノードのファイルを検索する

# フォルダ構成
- /cmd : main.goなどのエントリポイント
  - main.go
- /Node
  - /service : 内部のロジック
    - cmd.go : cmdでのやりとりと文言の取得
    - searchiFile.go : ファイルの検索

  - /p2p : ノード間同士のやりとり
    - socket.go : 検索とダウンロードのクエリ

# 動作
1. ユーザーが欲しいファイルのキーワードを検索
2. 相手ノードに検索クエリの発行
3. もう一方のノードはキーワードにヒットしたファイル一覧を表示（なければない旨を表示）
4. ファイルを選択してダウンロード
5. 結果にファイルパスを表示

## 1. ユーザーが検索する
- 場所
  - ターミナル
- 検索のやり方
  - `スペース区切り` で３つまで検索ワードを入力する

## 2. 相手ノードへの検索クエリの実行
- 検索方法
  - ソケット通信を使った検索クエリの発行（リクエストボディに検索条件を詰め込む）：TCP通信の実装
  - 参考：[GoでたたくTCPソケット（前編）](https://ascii.jp/elem/000/001/276/1276572/)

## 3. ファイル一覧の表示
- 一覧取得方法
  1. 相手ノードからのレスポンスボディ内のファイル一覧を取得
  2. ファイル一覧を表示

      ある場合 : 自ノードか相手ノードか示した上で一覧表示

      ない場合 : `検索結果はありません` と表示

## 4. ファイルを選択し、ダウンロード
- ファイル選択方法
  - ファイル一覧を番号で表示し、ダウンロードしたい番号を選択
  - 選択するものがない場合は0を選択
- ファイルダウンロード
    - fileをzip→byteに変換しレスポンスに含める
  - クライアント実装
    - レスポンスをbyte→zip→ファイルに変換して保存
  - 応用
    - 分割ダウンロードのため[pget](https://github.com/Code-Hex/pget)を使用
    - サーバー側に分割ダウンロード対応のため `Accept-Ranges: bytes` がヘッダーに必要？？

## 5. ファイルパスを表示
-  `ダウンロード完了` の文言とともにファイルパスを表示

# アーキテクチャ
2つのDockerを立ち上げてDocker間で通信。<br>
参考：[docker/docker-composeにおけるコンテナ間通信を実装する](https://dragon-taro.com/technology/post-556#outline__6)

## Docker情報

- Docker1
  - name : node1
  - port : 8080:8080

- Docker2
  - name : node2
  - port : 80:80

## ノード情報取得方法
address.jsonを用意し、初回通信時に読み込む。
- ファイル内容
  - 自分のノード情報
  - 相手のノード情報

## プロトコル
[形式]
`{identifical header}:{method}:{body}:{check sum};`

`:` を区切り文字として、終わりは`;` とする。

- identifical header
  - 001 : レスポンスが必要なクエリ（検索等）
  - 002 : レスポンスが必要ないクエリ（伝搬等）
- method
  - search : ファイルの検索
  - download : ファイルのダウンロード
- body
  - methodに応じたbody
- check sum
  - identifical header / method / bodyのリクエスト時のチェックサムで改竄がないかチェックする
